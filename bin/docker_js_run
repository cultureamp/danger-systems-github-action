#!/bin/bash
set -euo pipefail

DANGERFILE_CUSTOM_PATH=${DANGERFILE_CUSTOM_PATH:-}

cd ./.danger

yarn --no-progress --frozen-lockfile

# Install danger if it not in the project deps
yarn run danger -V &>/dev/null || {
  yarn add --dev danger
}

# Run danger
if [[ -z "$DANGERFILE_CUSTOM_PATH" ]]; then
  yarn run danger ci
else
  echo "::debug::Using custom dangerfile path: $DANGERFILE_CUSTOM_PATH"
  yarn run danger ci --dangerfile "$DANGERFILE_CUSTOM_PATH"
fi;
